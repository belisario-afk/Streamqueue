<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, viewport-fit=cover"
    />
    <title>dwdw â€¢ Spotify Visual VJ</title>
    <meta name="theme-color" content="#0b0b0b" />
    <meta name="description" content="Audio-reactive VJ for Spotify with PKCE." />
    <link rel="icon" href="%BASE_URL%icon.svg" />
    <style>
      :root {
        --bg: #0b0b0b;
        --fg: #f0f0f0;
        --muted: #9aa0a6;
        --accent: #59ffa9;
        --accent-2: #5aaaff;
        --accent-3: #ff59be;
        --danger: #ff4d4f;
        --hi: #fff;
        --lo: #000;
        --palette-0: #59ffa9;
        --palette-1: #5aaaff;
        --palette-2: #ff59be;
        --palette-3: #ffe459;
        --palette-4: #ff8a59;
      }
      html, body, #app {
        height: 100%;
        margin: 0;
        background: var(--bg);
        color: var(--fg);
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji";
      }
      #root {
        position: fixed;
        inset: 0;
        overflow: hidden;
      }
      canvas#vis {
        position: absolute;
        inset: 0;
        width: 100%;
        height: 100%;
        display: block;
        background: radial-gradient(ellipse at 50% 50%, #0f0f13, #060608 60%, #020203);
      }
      .ui {
        position: absolute;
        inset: 0;
        pointer-events: none;
      }
      .toolbar, .panels {
        pointer-events: auto;
      }
      .toolbar {
        position: absolute;
        left: 0; right: 0; bottom: 0;
        display: flex;
        gap: 8px;
        padding: 10px 12px;
        align-items: center;
        background: linear-gradient(to top, rgba(0,0,0,0.65), rgba(0,0,0,0));
      }
      .btn, select, input[type="range"], input[type="checkbox"], .chip {
        font: inherit;
        color: var(--fg);
        background: rgba(255,255,255,0.06);
        border: 1px solid rgba(255,255,255,0.12);
        border-radius: 8px;
        padding: 8px 10px;
        transition: background .2s ease, border-color .2s ease;
      }
      .btn:hover { background: rgba(255,255,255,0.12); }
      .btn.primary { background: var(--accent); color: #000; border: none; }
      .spacer { flex: 1; }
      .panel {
        position: absolute;
        top: 12px;
        right: 12px;
        width: 340px;
        max-width: calc(100% - 24px);
        max-height: 70vh;
        overflow: auto;
        background: rgba(0,0,0,0.5);
        border: 1px solid rgba(255,255,255,0.1);
        border-radius: 12px;
        padding: 12px;
        backdrop-filter: blur(10px);
      }
      .panel h3 { margin: 8px 0 8px; font-weight: 600; }
      .row { display: flex; align-items: center; gap: 8px; margin: 6px 0; }
      .row label { flex: 1; color: var(--muted); }
      .meter {
        position: absolute; top: 12px; left: 12px;
        display: flex; gap: 6px; align-items: center;
        background: rgba(0,0,0,0.5);
        border: 1px solid rgba(255,255,255,0.1);
        border-radius: 10px;
        padding: 6px 10px;
      }
      .meter .dot { width: 8px; height: 8px; border-radius: 50%; background: var(--accent); }
      .tag { font-size: 12px; color: var(--muted); }
      .scene-chip { cursor: pointer; }
      .hidden { display: none !important; }
      .device-picker { min-width: 180px; }
      .kbd { background: rgba(255,255,255,0.08); border-radius: 6px; padding: 2px 6px; border: 1px solid rgba(255,255,255,0.15); }
      .cover {
        position: absolute; top: 12px; left: 12px;
        width: 84px; height: 84px; border-radius: 10px; overflow: hidden;
        border: 1px solid rgba(255,255,255,0.12);
      }
      .cover img { width: 100%; height: 100%; object-fit: cover; display: block; }
      .title {
        position: absolute; top: 12px; left: 108px; right: 12px;
        display: flex; flex-direction: column; gap: 4px;
        text-shadow: 0 1px 0 rgba(0,0,0,0.8);
      }
      .title .track { font-size: clamp(20px, 3.5vw, 40px); font-weight: 700; letter-spacing: 0.2px; }
      .title .artist { color: var(--muted); }
      .screensaver {
        position: absolute; inset: 0; display: none; align-items: center; justify-content: center;
        background: radial-gradient(ellipse at 50% 50%, rgba(0,0,0,0.35), rgba(0,0,0,0.8));
        color: var(--muted);
        font-size: 20px; letter-spacing: 0.5px;
      }
      .screensaver.active { display: flex; }
    </style>
    <script>
      // Spotify Web Playback SDK
      window.onSpotifyWebPlaybackSDKReady = () => {};
    </script>
    <script defer src="https://sdk.scdn.co/spotify-player.js"></script>
  </head>
  <body>
    <div id="root">
      <canvas id="vis"></canvas>

      <div class="ui">
        <div class="cover"><img id="cover-img" alt="cover" /></div>
        <div class="title">
          <div id="track-title" class="track">dwdw</div>
          <div id="track-artist" class="artist"></div>
        </div>

        <div class="meter">
          <div class="dot" id="beat-dot"></div>
          <div id="fps-label" class="tag">FPS: --</div>
          <div id="gpu-label" class="tag"></div>
        </div>

        <!-- panels and toolbar unchanged ... -->
      </div>
    </div>

    <!-- Important: use /src/main.ts so Vite can resolve; base is handled by config -->
    <script type="module" src="/src/main.ts"></script>
  </body>
</html>