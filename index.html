<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, viewport-fit=cover" />
    <title>dwdw • Spotify Visual VJ</title>
    <meta name="theme-color" content="#0b0b0b" />
    <meta name="description" content="Audio-reactive VJ for Spotify with PKCE." />
    <link rel="icon" href="%BASE_URL%/icon.svg" />
    <style>
      :root { --bg:#0b0b0b; --fg:#f0f0f0; --muted:#9aa0a6; --accent:#59ffa9; --accent-2:#5aaaff; --accent-3:#ff59be; --palette-0:#59ffa9; --palette-1:#5aaaff; --palette-2:#ff59be; --palette-3:#ffe459; --palette-4:#ff8a59; }
      html, body, #app { height:100%; margin:0; background:var(--bg); color:var(--fg); font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial; }
      #root { position:fixed; inset:0; overflow:hidden; }
      canvas#vis { position:absolute; inset:0; width:100%; height:100%; display:block; background: radial-gradient(ellipse at 50% 50%, #0f0f13, #060608 60%, #020203); }
      .ui { position:absolute; inset:0; pointer-events:none; }
      .toolbar, .panels { pointer-events:auto; }
      .toolbar { position:absolute; left:0; right:0; bottom:0; display:flex; flex-wrap:wrap; gap:8px; padding:10px 12px; align-items:center; background: linear-gradient(to top, rgba(0,0,0,0.65), rgba(0,0,0,0)); }
      .btn, select, input[type="range"], input[type="checkbox"], .chip { font: inherit; color: var(--fg); background: rgba(255,255,255,0.06); border: 1px solid rgba(255,255,255,0.12); border-radius: 8px; padding: 8px 10px; }
      .btn.primary { background: var(--accent); color:#000; border:none; }
      .panel { position:absolute; top:12px; right:12px; width:360px; max-width: calc(100% - 24px); max-height: 70vh; overflow:auto; background: rgba(0,0,0,0.5); border:1px solid rgba(255,255,255,0.1); border-radius:12px; padding:12px; backdrop-filter: blur(10px); }
      .row { display:flex; align-items:center; gap:8px; margin:6px 0; }
      .row label { flex:1; color: var(--muted); }
      .tag { font-size: 12px; color: var(--muted); }
      .cover { position:absolute; top:12px; left:12px; width:84px; height:84px; border-radius:10px; overflow:hidden; border:1px solid rgba(255,255,255,0.12); }
      .title { position:absolute; top:12px; left:108px; right:12px; display:flex; flex-direction:column; gap:4px; text-shadow: 0 1px 0 rgba(0,0,0,0.8); }
      .screensaver { position:absolute; inset:0; display:none; align-items:center; justify-content:center; background: radial-gradient(ellipse at 50% 50%, rgba(0,0,0,0.35), rgba(0,0,0,0.8)); color:var(--muted); font-size:20px; }
      .screensaver.active { display:flex; }
      .panel.small { width:320px; right:380px; }
    </style>
    <script>window.onSpotifyWebPlaybackSDKReady = () => {};</script>
    <script defer src="https://sdk.scdn.co/spotify-player.js"></script>
  </head>
  <body>
    <div id="root">
      <canvas id="vis"></canvas>

      <div class="ui">
        <div class="cover"><img id="cover-img" alt="cover" /></div>
        <div class="title">
          <div id="track-title" class="track">dwdw</div>
          <div id="track-artist" class="artist"></div>
        </div>

        <div class="panel panels" id="panel-scene" style="top: 12px; right: 12px;">
          <h3>Scene Settings</h3>
          <div class="row">
            <label>Scene</label>
            <select id="scene-picker">
              <option value="auto">Auto</option>
              <option value="particles">Particles</option>
              <option value="fluid">Fluid</option>
              <option value="tunnel">Tunnel</option>
              <option value="terrain">Terrain</option>
              <option value="type">Typography</option>
              <option value="basic">Basic</option>
            </select>
          </div>
          <div id="scene-settings"></div>
        </div>

        <div class="panel panels small" id="panel-quality" style="top: 12px; right: 392px;">
          <h3>Quality & Performance</h3>
          <div class="row">
            <label>Render scale</label>
            <input id="q-scale" type="range" min="1" max="1.6" step="0.05" value="1">
          </div>
          <div class="row">
            <label>Target FPS</label>
            <input id="perf-fps" type="range" min="30" max="120" step="10" value="60">
          </div>
          <div class="row">
            <span id="fps-label" class="tag">FPS: --</span>
            <span id="gpu-label" class="tag"></span>
          </div>
        </div>

        <div class="toolbar">
          <button id="login-btn" class="btn primary">Login with Spotify</button>
          <button id="playpause-btn" class="btn">Play/Pause</button>
          <button id="prev-btn" class="btn">Prev</button>
          <button id="next-btn" class="btn">Next</button>
          <div class="row">
            <label for="seek-range" class="tag">Seek</label>
            <input id="seek-range" type="range" min="0" max="1000" step="1" value="0" style="width: 220px;">
            <span id="seek-label" class="tag">0:00 / 0:00</span>
          </div>
          <div class="row">
            <label for="volume-range" class="tag">Vol</label>
            <input id="volume-range" type="range" min="0" max="100" step="1" value="70" style="width: 120px;">
          </div>
          <select id="device-picker" class="device-picker"></select>
          <div class="spacer"></div>
          <span id="mode-label" class="chip">Device control</span>
        </div>

        <div id="screensaver" class="screensaver"><div>Ambient mode — press any key or play a track</div></div>
      </div>
    </div>
    <script type="module" src="/src/main.ts"></script>
  </body>
</html>